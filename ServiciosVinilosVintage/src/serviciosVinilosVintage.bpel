<?xml version="1.0" encoding="UTF-8" ?>
<process
    name="serviciosVinilosVintage"
    targetNamespace="http://enterprise.netbeans.org/bpel/ServiciosVinilosVintage/serviciosVinilosVintage"
    xmlns:tns="http://enterprise.netbeans.org/bpel/ServiciosVinilosVintage/serviciosVinilosVintage"
    xmlns:xs="http://www.w3.org/2001/XMLSchema"
    xmlns:xsd="http://www.w3.org/2001/XMLSchema"
    xmlns="http://docs.oasis-open.org/wsbpel/2.0/process/executable"
    xmlns:sxt="http://www.sun.com/wsbpel/2.0/process/executable/SUNExtension/Trace" 
    xmlns:sxed="http://www.sun.com/wsbpel/2.0/process/executable/SUNExtension/Editor2"
    xmlns:sxat="http://www.sun.com/wsbpel/2.0/process/executable/SUNExtension/Attachment"
    xmlns:sxeh="http://www.sun.com/wsbpel/2.0/process/executable/SUNExtension/ErrorHandling" xmlns:ns0="http://xml.netbeans.org/schema/VinilosVintachSchema">
    <import namespace="http://enterprise.netbeans.org/bpel/WSMusicaPedidosWrapper" location="WSMusicaPedidosWrapper.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"/>
    <import namespace="http://wsmusicapedidos/" location="http://localhost:8080/WS_Musica_Pedidos/WSMusicaPedidos?WSDL" importType="http://schemas.xmlsoap.org/wsdl/"/>
    <import namespace="http://enterprise.netbeans.org/bpel/WS_Musica_EnviosWrapper" location="WS_Musica_EnviosWrapper.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"/>
    <import namespace="http://wsmusicaenvios/" location="http://localhost:8080/WS_Musica_Envios/WS_Musica_Envios?WSDL" importType="http://schemas.xmlsoap.org/wsdl/"/>
    <import namespace="http://enterprise.netbeans.org/bpel/WSMusicaCreditoWrapper" location="WSMusicaCreditoWrapper.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"/>
    <import namespace="http://wsmusicacredito/" location="http://localhost:8080/WS_Musica_Credito/WSMusicaCredito?WSDL" importType="http://schemas.xmlsoap.org/wsdl/"/>
    <import namespace="http://j2ee.netbeans.org/wsdl/ServiciosVinilosVintage/DescriptorBPEL/VinilosVintach" location="DescriptorBPEL/VinilosVintach.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"/>
    <partnerLinks>
        <partnerLink name="VinilosVintach" xmlns:tns="http://j2ee.netbeans.org/wsdl/ServiciosVinilosVintage/DescriptorBPEL/VinilosVintach" partnerLinkType="tns:VinilosVintach" myRole="VinilosVintachPortTypeRole"/>
        <partnerLink name="WSPedidos" xmlns:tns="http://enterprise.netbeans.org/bpel/WSMusicaPedidosWrapper" partnerLinkType="tns:WSMusicaPedidosLinkType" partnerRole="WSMusicaPedidosRole"/>
        <partnerLink name="WSCredito" xmlns:tns="http://enterprise.netbeans.org/bpel/WSMusicaCreditoWrapper" partnerLinkType="tns:WSMusicaCreditoLinkType" partnerRole="WSMusicaCreditoRole"/>
        <partnerLink name="WSEnvios" xmlns:tns="http://enterprise.netbeans.org/bpel/WS_Musica_EnviosWrapper" partnerLinkType="tns:WS_Musica_EnviosLinkType" partnerRole="WS_Musica_EnviosRole"/>
    </partnerLinks>
    <variables>
        <variable name="VinilosVintachOperationOut" xmlns:tns="http://j2ee.netbeans.org/wsdl/ServiciosVinilosVintage/DescriptorBPEL/VinilosVintach" messageType="tns:VinilosVintachOperationResponse"/>
        <variable name="VinilosVintachOperationIn" xmlns:tns="http://j2ee.netbeans.org/wsdl/ServiciosVinilosVintage/DescriptorBPEL/VinilosVintach" messageType="tns:VinilosVintachOperationRequest">
            <sxed:editor>
                <sxed:predicate path="$VinilosVintachOperationIn.part1/ns0:clsItem[$ForEach1Counter]" source="from"/>
            </sxed:editor>
        </variable>
        <variable name="AltaPedidoOut" xmlns:tns="http://wsmusicapedidos/" messageType="tns:altaPedidoResponse"/>
        <variable name="AltaPedidoIn" xmlns:tns="http://wsmusicapedidos/" messageType="tns:altaPedido">
            <sxed:editor>
                <sxed:predicate path="$AltaPedidoIn.parameters/lista_it[$ForEach1Counter]" source="to"/>
            </sxed:editor>
        </variable>
        </variables>
    <sequence>
        <receive name="RecibirPedido" createInstance="yes" partnerLink="VinilosVintach" operation="VinilosVintachOperation" xmlns:tns="http://j2ee.netbeans.org/wsdl/ServiciosVinilosVintage/DescriptorBPEL/VinilosVintach" portType="tns:VinilosVintachPortType" variable="VinilosVintachOperationIn"/>
        <forEach name="ForEachClsItem" parallel="no" counterName="ForEach1Counter">
            <scope name="Scope1">
                <assign name="Assign1">
                    
                        <copy>
                            <from>$VinilosVintachOperationIn.part1/ns0:clsItem[$ForEach1Counter]/ns0:idProducto
                            <sxed:editor>
                                            <sxed:predicate path="$VinilosVintachOperationIn.part1/ns0:clsItem[$ForEach1Counter]" source="from"/>
                                        </sxed:editor>
                                </from>
                                <to>$AltaPedidoIn.parameters/lista_it/id_prod</to>
                        </copy>
                        <copy>
                            <from>$VinilosVintachOperationIn.part1/ns0:clsItem[$ForEach1Counter]/ns0:cantidad
                            <sxed:editor>
                                            <sxed:predicate path="$VinilosVintachOperationIn.part1/ns0:clsItem[$ForEach1Counter]" source="from"/>
                                        </sxed:editor>
                                </from>
                                <to>$AltaPedidoIn.parameters/lista_it/cantidad</to>
                        </copy>
                        <copy>
                            <from>$AltaPedidoOut.parameters/return</from>
                                <to variable="VinilosVintachOperationOut" part="numeroPedido"/>
                        </copy>
                </assign>
            </scope>
        </forEach>

        <invoke name="altaPedido" partnerLink="WSPedidos" operation="altaPedido" xmlns:tns="http://wsmusicapedidos/" portType="tns:WSMusicaPedidos" inputVariable="AltaPedidoIn" outputVariable="AltaPedidoOut"/>
        <reply name="NumPedido" partnerLink="VinilosVintach" operation="VinilosVintachOperation" xmlns:tns="http://j2ee.netbeans.org/wsdl/ServiciosVinilosVintage/DescriptorBPEL/VinilosVintach" portType="tns:VinilosVintachPortType" variable="VinilosVintachOperationOut"/>
    </sequence>
</process>